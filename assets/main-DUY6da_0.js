import{m as o,t as $}from"./typeIcons-wyGrPWsT.js";const e={allPokemons:[],filteredPokemons:[],currentPage:1,itemsPerPage:12,sortOption:"id-asc",currentFilterType:"",searchTerm:""};function M(t){const r={currentPage:e.currentPage,currentSort:e.sortOption,currentFilterType:e.currentFilterType||"",searchTerm:o.searchInput.value.trim()};localStorage.setItem("pokedexState",JSON.stringify(r)),localStorage.setItem("currentPokemonID",t),window.location.href=`details.html?id=${t}`}const p=12;async function w(){try{const r=await(await fetch("https://pokeapi.co/api/v2/pokemon?limit=10000")).json();e.allPokemons=r.results.filter(n=>l(n.url)<1e4),console.log("Pokemons loaded:",e.allPokemons),e.totalPages=Math.ceil(e.allPokemons.length/p)}catch(t){throw console.error("Error fetching all pokemons:",t),t}}async function y(t){try{return await(await fetch(`https://pokeapi.co/api/v2/pokemon/${t}`)).json()}catch(r){return console.error(`Failed to fetch Pokemon data for ID ${t}:`,r),null}}function l(t){const r=t.split("/").filter(Boolean);return parseInt(r[r.length-1],10)}function x(t){return t.charAt(0).toUpperCase()+t.slice(1)}async function m(){try{o.listWrapper.innerHTML="",o.loader.style.display="flex",h();const t=e.filteredPokemons.length>0?e.filteredPokemons:e.allPokemons;e.totalPages=Math.ceil(t.length/p),e.currentPage>e.totalPages&&e.totalPages>0&&(e.currentPage=e.totalPages);const r=(e.currentPage-1)*p,n=r+p,a=t.slice(r,n),c=await Promise.all(a.map(d=>y(l(d.url))));I(a,c),F()}catch(t){console.error("Error loading pokemons:",t)}finally{o.loader.style.display="none"}}function I(t,r){o.listWrapper.innerHTML="",o.listWrapper.style.opacity="0";const n=document.createDocumentFragment(),a=[];t.forEach((c,d)=>{if(r[d]){const P=l(c.url),{card:i,imageLoadPromise:f}=B(c,P,r[d]);a.push(f),n.appendChild(i)}}),o.listWrapper.appendChild(n),Promise.all(a).then(()=>{o.listWrapper.style.opacity="1"})}function B(t,r,n){if(!n)return document.createElement("div");const a=document.createElement("div");a.className="card",a.dataset.id=r;const d=n.types.map(s=>s.type.name).map(s=>`
    <div class="card__type ${s}">
      <img src="${$[s]}" title="${s}" alt="${s}" />
      <div>${s}</div>
    </div>
  `).join("");a.innerHTML=`
    <div class="card__id">#${String(r).padStart(4,"0")}</div>
    <div class="card__img"></div>
    <div class="card__name">${x(t.name)}</div>
    <div class="card__types">${d}</div>
  `;const P=(s,_)=>{var v,S,T,L;return s!=null&&s.sprites?((S=(v=s.sprites.other)==null?void 0:v.home)==null?void 0:S.front_default)||((L=(T=s.sprites.other)==null?void 0:T["official-artwork"])==null?void 0:L.front_default)||s.sprites.front_default:`https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/home/${_}.png`},i=document.createElement("img");i.src=P(n,r),i.alt=t.name,i.loading="lazy",i.onerror=()=>{i.src=`https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/${r}.png`,i.onerror=()=>{i.src=`https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/${r}.png`}};const f=new Promise(s=>{i.onload=()=>{i.classList.add("loaded"),s()},i.onerror=()=>s()});return a.querySelector(".card__img").appendChild(i),a.addEventListener("click",()=>{M(r)}),{card:a,imageLoadPromise:f}}function F(){o.pageInfo.textContent=`Page ${e.currentPage} of ${e.totalPages}`,o.pageInput.value=e.currentPage,o.firstButton.disabled=e.currentPage===1,o.prevButton.disabled=e.currentPage===1,o.nextButton.disabled=e.currentPage===e.totalPages||e.totalPages===0,o.lastButton.disabled=e.currentPage===e.totalPages||e.totalPages===0}async function N(){o.listWrapper.innerHTML="",o.loader.style.display="flex";try{const t=(e.currentPage-1)*p,r=t+p,n=e.filteredPokemons.slice(t,r),a=await Promise.all(n.map(c=>y(l(c.url))));I(n,a),F()}catch(t){console.error("Error displaying filtered pokemons:",t)}finally{o.loader.style.display="none"}}function O(){o.listWrapper.innerHTML=`
    <div class="no-results">No Pokémon found</div>
  `}async function u(t){t=Math.max(1,Math.min(t,e.totalPages)),t!==e.currentPage&&(e.currentPage=t,await m())}async function A(){const t=o.filterSelect.value;if(e.currentFilterType=t,!e.allPokemons.length){console.warn("Pokemons are not yet loaded.");return}t===""?g():await b(t)}async function b(t){try{if(o.listWrapper.innerHTML="",o.loader.style.display="flex",!t)e.filteredPokemons=[],e.currentFilterType="";else{const r=await Promise.all(e.allPokemons.map(n=>y(l(n.url))));e.filteredPokemons=e.allPokemons.filter((n,a)=>{const c=r[a];return c&&c.types.some(d=>d.type.name===t)}),e.currentFilterType=t,h()}e.currentPage=1,await m()}catch(r){console.error("Error filtering pokemons by type:",r)}finally{o.loader.style.display="none"}}function g(){console.log("Resetting type filter, showing all pokemons."),e.currentFilterType="",e.filteredPokemons=[...e.allPokemons],h(),e.currentPage=1,m()}function h(){const t=e.filteredPokemons.length>0?e.filteredPokemons:e.allPokemons;switch(e.sortOption){case"id-asc":t.sort((r,n)=>l(r.url)-l(n.url));break;case"id-desc":t.sort((r,n)=>l(n.url)-l(r.url));break;case"name-asc":t.sort((r,n)=>r.name.localeCompare(n.name));break;case"name-desc":t.sort((r,n)=>n.name.localeCompare(r.name));break}e.filteredPokemons.length>0?e.filteredPokemons=t:e.allPokemons=t}function H(){const t=o.searchInput.value.toLowerCase().trim();e.searchTerm=t,t?W(t):C(),o.searchClear.style.display=t?"block":"none"}function W(t){e.filteredPokemons=e.allPokemons.filter(r=>{const n=l(r.url).toString(),a=r.name.toLowerCase();return n.includes(t)||a.includes(t)}),e.totalPages=Math.ceil(e.filteredPokemons.length/p),e.currentPage=1,e.filteredPokemons.length===0?O():N()}function C(){e.filteredPokemons=[...e.allPokemons],e.searchTerm="",e.currentPage=1,o.searchInput.value="",o.searchClear.style.display="none",m();const t=JSON.parse(localStorage.getItem("pokedexState")||"{}");t.searchTerm="",localStorage.setItem("pokedexState",JSON.stringify(t))}function J(){C()}function k(){const t=o.sortSelect.value;e.sortOption=t;const r=e.filteredPokemons.length>0?e.filteredPokemons:e.allPokemons;switch(t){case"id-asc":r.sort((n,a)=>l(n.url)-l(a.url));break;case"id-desc":r.sort((n,a)=>l(a.url)-l(n.url));break;case"name-asc":r.sort((n,a)=>n.name.localeCompare(a.name));break;case"name-desc":r.sort((n,a)=>a.name.localeCompare(n.name));break}e.filteredPokemons.length>0?e.filteredPokemons=r:e.allPokemons=r,e.currentPage=1,m()}function R(){o.firstButton.addEventListener("click",()=>u(1)),o.prevButton.addEventListener("click",()=>u(e.currentPage-1)),o.nextButton.addEventListener("click",()=>u(e.currentPage+1)),o.lastButton.addEventListener("click",()=>u(e.totalPages)),o.goButton.addEventListener("click",E),o.pageInput.addEventListener("keypress",t=>{t.key==="Enter"&&E()}),o.filterSelect.addEventListener("change",A),o.searchInput.addEventListener("input",H),o.searchClear.addEventListener("click",J),o.sortSelect.addEventListener("change",()=>{e.currentSort=o.sortSelect.value,k()})}function E(){const t=parseInt(o.pageInput.value,10);!isNaN(t)&&t>=1&&t<=e.totalPages?u(t):o.pageInput.value=e.currentPage}o.loader.innerHTML=`
  <div class="loader-container">
    <div class="o-pokeball u-tada"></div>
    <p class="loader-text">Pokémons are coming...</p>
  </div>
`;document.body.appendChild(o.loader);async function j(){try{const t=localStorage.getItem("pokedexState");if(o.filterSelect.value="",e.currentFilterType="",t){const r=JSON.parse(t);o.searchInput.value=r.searchTerm||"",o.sortSelect.value=r.currentSort||"id-asc",r.currentFilterType&&(o.filterSelect.value=r.currentFilterType,e.currentFilterType=r.currentFilterType),await w(),k(),r.searchTerm||(r.currentFilterType?await b(r.currentFilterType):g())}else o.loader.style.display="flex",await w(),k(),g();R()}catch(t){console.error("Error initializing app:",t)}finally{o.loader.style.display="none"}}j();
