import{m as r,t as M}from"./typeIcons-DLPoXDS0.js";const e={allPokemons:[],filteredPokemons:[],currentPage:1,itemsPerPage:12,sortOption:"id-asc",currentFilterType:"",searchTerm:""};function I(t){const n={currentPage:e.currentPage,currentSort:e.sortOption,currentFilterType:e.currentFilterType||"",searchTerm:r.searchInput.value.trim()};localStorage.setItem("pokedexState",JSON.stringify(n)),localStorage.setItem("currentPokemonID",t),window.location.href=`details.html?id=${t}`}const m=12;async function B(){try{const n=await(await fetch("https://pokeapi.co/api/v2/pokemon?limit=10000")).json();e.allPokemons=n.results.filter(a=>i(a.url)<1e4),e.totalPages=Math.ceil(e.allPokemons.length/m)}catch(t){throw console.error("Error fetching all pokemons:",t),t}}async function y(t){try{return await(await fetch(`https://pokeapi.co/api/v2/pokemon/${t}`)).json()}catch(n){return console.error(`Failed to fetch Pokemon data for ID ${t}:`,n),null}}function i(t){try{const n=t.split("/").filter(Boolean);return parseInt(n[n.length-1],10)}catch(n){return console.error(`Error parsing Pokemon URL: ${t}`,n),null}}function _(t){return t.charAt(0).toUpperCase()+t.slice(1)}function p(t){r.loader&&(r.loader.style.display=t?"flex":"none")}async function P(){try{r.listWrapper.innerHTML="",p(!0);const t=e.filteredPokemons.length>0?e.filteredPokemons:e.allPokemons;e.totalPages=Math.max(1,Math.ceil(t.length/m)),e.currentPage=Math.max(1,Math.min(e.currentPage,e.totalPages));const n=t.slice((e.currentPage-1)*m,e.currentPage*m),a=await Promise.all(n.map(async o=>{try{return await y(i(o.url))}catch(l){return console.error(`Failed to load pokemon ${o.name}:`,l),null}}));await E(n,a)}catch{console.error("Error loading pokemons:",error),x()}finally{p(!1),S()}}function E(t,n){r.listWrapper.innerHTML="",r.listWrapper.style.opacity="0";const a=document.createDocumentFragment(),o=[];t.forEach((l,d)=>{if(n[d]){const f=i(l.url),{card:c,imageLoadPromise:g}=C(l,f,n[d]);o.push(g),a.appendChild(c)}}),r.listWrapper.appendChild(a),Promise.all(o).then(()=>{r.listWrapper.style.opacity="1"})}function C(t,n,a){var h;const o=document.createElement("div");o.className="card",o.dataset.id=n;const d=(((h=a==null?void 0:a.types)==null?void 0:h.map(s=>s.type.name))||[]).map(s=>`
        <div class="card__type ${s}">
            <img src="${M[s]}" title="${s}" alt="${s}" />
            <div>${s}</div>
        </div>
    `).join("");o.innerHTML=`
        <div class="card__id">#${String(n).padStart(4,"0")}</div>
        <div class="card__img"></div>
        <div class="card__name">${_(t.name)}</div>
        <div class="card__types">${d}</div>
    `;const f=(s,F)=>{var k,v,L,T;return s!=null&&s.sprites?((v=(k=s.sprites.other)==null?void 0:k.home)==null?void 0:v.front_default)||((T=(L=s.sprites.other)==null?void 0:L["official-artwork"])==null?void 0:T.front_default)||s.sprites.front_default:`https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/home/${F}.png`},c=document.createElement("img");c.src=f(a,n),c.alt=t.name,c.loading="lazy";const g=new Promise(s=>{c.onload=()=>{c.classList.add("loaded"),s()},c.onerror=()=>s()});return o.querySelector(".card__img").appendChild(c),o.addEventListener("click",()=>{I(n)}),{card:o,imageLoadPromise:g}}function S(){r.pageInfo.textContent=`Page ${e.currentPage} of ${e.totalPages}`,r.pageInput.value=e.currentPage,document.querySelectorAll(".firstButton, .prevButton").forEach(t=>{t.disabled=e.currentPage===1,t.classList.toggle("disabled",e.currentPage===1)}),document.querySelectorAll(".nextButton, .lastButton").forEach(t=>{t.disabled=e.currentPage===e.totalPages||e.totalPages===0,t.classList.toggle("disabled",e.currentPage===e.totalPages||e.totalPages===0)})}async function $(){r.listWrapper.innerHTML="",p(!0);try{const t=(e.currentPage-1)*m,n=t+m,a=e.filteredPokemons.slice(t,n),o=await Promise.all(a.map(l=>y(i(l.url))));E(a,o),S()}catch(t){console.error("Error displaying filtered pokemons:",t)}finally{p(!1)}}function W(){r.listWrapper.innerHTML=`
        <div class="no-results">No Pokémon found</div>
    `}async function u(t){t=Math.max(1,Math.min(t,e.totalPages)),t!==e.currentPage&&(e.currentPage=t,await P())}function x(){var t;r.listWrapper.innerHTML=`
        <div class="error-state">
            <p>Failed to load Pokémon data</p>
            <button class="retry-button">Try Again</button>
        </div>
    `,(t=r.listWrapper.querySelector(".retry-button"))==null||t.addEventListener("click",P)}async function A(){const t=r.filterSelect.value;if(e.currentFilterType=t,!e.allPokemons.length){console.warn("Pokemons are not yet loaded.");return}t===""?N():await H(t)}async function H(t){try{if(r.listWrapper.innerHTML="",p(!0),!t)e.filteredPokemons=[],e.currentFilterType="";else{const n=await Promise.all(e.allPokemons.map(a=>y(i(a.url))));e.filteredPokemons=e.allPokemons.filter((a,o)=>{const l=n[o];return l&&l.types.some(d=>d.type.name===t)}),e.currentFilterType=t}e.currentPage=1,await P()}catch(n){console.error("Error filtering pokemons by type:",n)}finally{p(!1)}}function N(){e.currentFilterType="",e.filteredPokemons=[...e.allPokemons],e.currentPage=1,P()}function O(){const t=r.searchInput.value.toLowerCase().trim();e.searchTerm=t,r.searchClear.style.display=t?"block":"none",t?R(t):w()}function R(t){const a=(e.currentFilterType?e.typeFiltered:e.allPokemons).filter(o=>{const l=i(o.url).toString(),d=o.name.toLowerCase();return l.includes(t)||d.includes(t)});e.currentDisplay=a,e.filteredPokemons=a,q()}function q(){e.totalPages=Math.ceil(e.currentDisplay.length/m),e.currentPage=1,e.currentDisplay.length===0?W():$()}function z(){r.searchInput&&(r.searchInput.value=""),r.searchClear&&(r.searchClear.style.display="none"),w(),r.listWrapper&&(r.listWrapper.style.opacity="0",setTimeout(()=>{r.listWrapper.style.opacity="1"},150))}function w(){e.searchTerm="",e.filteredPokemons=e.currentFilterType?e.typeFiltered:e.allPokemons,e.currentPage=1,P()}function U(){const t=e.filteredPokemons.length>0?e.filteredPokemons:e.allPokemons;switch(e.sortOption){case"id-asc":t.sort((n,a)=>i(n.url)-i(a.url));break;case"id-desc":t.sort((n,a)=>i(a.url)-i(n.url));break;case"name-asc":t.sort((n,a)=>n.name.localeCompare(a.name));break;case"name-desc":t.sort((n,a)=>a.name.localeCompare(n.name));break}P()}function j(){r.firstButton.addEventListener("click",()=>u(1)),r.prevButton.addEventListener("click",()=>u(e.currentPage-1)),r.nextButton.addEventListener("click",()=>u(e.currentPage+1)),r.lastButton.addEventListener("click",()=>u(e.totalPages)),r.firstButtonMobile.addEventListener("click",()=>u(1)),r.prevButtonMobile.addEventListener("click",()=>u(e.currentPage-1)),r.nextButtonMobile.addEventListener("click",()=>u(e.currentPage+1)),r.lastButtonMobile.addEventListener("click",()=>u(e.totalPages)),r.pageInput.addEventListener("keypress",t=>{t.key==="Enter"&&G()}),r.filterSelect.addEventListener("change",A),r.searchInput.addEventListener("input",O),r.searchClear.addEventListener("click",z),r.sortSelect.addEventListener("change",()=>{e.sortOption=r.sortSelect.value,U();const t={currentPage:e.currentPage,currentSort:e.sortOption,currentFilterType:e.currentFilterType,searchTerm:e.searchTerm};localStorage.setItem("pokedexState",JSON.stringify(t))})}function G(){const t=parseInt(r.pageInput.value,10);!isNaN(t)&&t>=1&&t<=e.totalPages?u(t):r.pageInput.value=e.currentPage}async function b(){try{p(!0),await B(),e.filteredPokemons=[...e.allPokemons],await P(),j()}catch(t){console.error("Error initializing app:",t),r.listWrapper.innerHTML=`
          <div class="error-message">
            Failed to initialize. <button id="retry-btn">Retry</button>
          </div>
        `,document.getElementById("retry-btn").addEventListener("click",b)}finally{p(!1)}}b();
