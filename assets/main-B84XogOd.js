import{m as n,t as _}from"./typeIcons-wyGrPWsT.js";const e={allPokemons:[],filteredPokemons:[],currentPage:1,itemsPerPage:12,sortOption:"id-asc",currentFilterType:"",searchTerm:""};function $(t){const r={currentPage:e.currentPage,currentSort:e.sortOption,currentFilterType:e.currentFilterType||"",searchTerm:n.searchInput.value.trim()};localStorage.setItem("pokedexState",JSON.stringify(r)),localStorage.setItem("currentPokemonID",t),window.location.href=`details.html?id=${t}`}const u=12;async function F(){try{const r=await(await fetch("https://pokeapi.co/api/v2/pokemon?limit=10000")).json();e.allPokemons=r.results.filter(o=>s(o.url)<1e4),console.log("Pokemons loaded:",e.allPokemons),e.totalPages=Math.ceil(e.allPokemons.length/u)}catch(t){throw console.error("Error fetching all pokemons:",t),t}}async function f(t){try{return await(await fetch(`https://pokeapi.co/api/v2/pokemon/${t}`)).json()}catch(r){return console.error(`Failed to fetch Pokemon data for ID ${t}:`,r),null}}function s(t){const r=t.split("/").filter(Boolean);return parseInt(r[r.length-1],10)}function B(t){return t.charAt(0).toUpperCase()+t.slice(1)}async function P(){try{n.loader.style.display="flex";const t=e.searchTerm||e.currentFilterType?e.filteredPokemons:e.allPokemons;e.totalPages=Math.ceil(t.length/u),e.currentPage=Math.min(e.currentPage,e.totalPages||1);const r=t.slice((e.currentPage-1)*u,e.currentPage*u),o=await Promise.all(r.map(a=>f(s(a.url))));I(r,o)}finally{n.loader.style.display="none"}}function I(t,r){n.listWrapper.innerHTML="",n.listWrapper.style.opacity="0";const o=document.createDocumentFragment(),a=[];t.forEach((i,p)=>{if(r[p]){const y=s(i.url),{card:c,imageLoadPromise:g}=x(i,y,r[p]);a.push(g),o.appendChild(c)}}),n.listWrapper.appendChild(o),Promise.all(a).then(()=>{n.listWrapper.style.opacity="1"})}function x(t,r,o){if(!o)return document.createElement("div");const a=document.createElement("div");a.className="card",a.dataset.id=r;const p=o.types.map(l=>l.type.name).map(l=>`
    <div class="card__type ${l}">
      <img src="${_[l]}" title="${l}" alt="${l}" />
      <div>${l}</div>
    </div>
  `).join("");a.innerHTML=`
    <div class="card__id">#${String(r).padStart(4,"0")}</div>
    <div class="card__img"></div>
    <div class="card__name">${B(t.name)}</div>
    <div class="card__types">${p}</div>
  `;const y=(l,M)=>{var T,w,S,L;return l!=null&&l.sprites?((w=(T=l.sprites.other)==null?void 0:T.home)==null?void 0:w.front_default)||((L=(S=l.sprites.other)==null?void 0:S["official-artwork"])==null?void 0:L.front_default)||l.sprites.front_default:`https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/home/${M}.png`},c=document.createElement("img");c.src=y(o,r),c.alt=t.name,c.loading="lazy",c.onerror=()=>{c.src=`https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/${r}.png`,c.onerror=()=>{c.src=`https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/${r}.png`}};const g=new Promise(l=>{c.onload=()=>{c.classList.add("loaded"),l()},c.onerror=()=>l()});return a.querySelector(".card__img").appendChild(c),a.addEventListener("click",()=>{$(r)}),{card:a,imageLoadPromise:g}}function A(){n.pageInfo.textContent=`Page ${e.currentPage} of ${e.totalPages}`,n.pageInput.value=e.currentPage,n.firstButton.disabled=e.currentPage===1,n.prevButton.disabled=e.currentPage===1,n.nextButton.disabled=e.currentPage===e.totalPages||e.totalPages===0,n.lastButton.disabled=e.currentPage===e.totalPages||e.totalPages===0}async function N(){n.listWrapper.innerHTML="",n.loader.style.display="flex";try{const t=(e.currentPage-1)*u,r=t+u,o=e.filteredPokemons.slice(t,r),a=await Promise.all(o.map(i=>f(s(i.url))));I(o,a),A()}catch(t){console.error("Error displaying filtered pokemons:",t)}finally{n.loader.style.display="none"}}function O(){n.listWrapper.innerHTML=`
    <div class="no-results">No Pokémon found</div>
  `}async function m(t){t=Math.max(1,Math.min(t,e.totalPages)),t!==e.currentPage&&(e.currentPage=t,await P())}async function W(){const t=n.filterSelect.value;if(e.currentFilterType=t,!e.allPokemons.length){console.warn("Pokemons are not yet loaded.");return}t===""?k():await C(t)}async function C(t){try{if(n.listWrapper.innerHTML="",n.loader.style.display="flex",!t)e.filteredPokemons=[],e.currentFilterType="";else{const r=await Promise.all(e.allPokemons.map(o=>f(s(o.url))));e.filteredPokemons=e.allPokemons.filter((o,a)=>{const i=r[a];return i&&i.types.some(p=>p.type.name===t)}),e.currentFilterType=t,v()}e.currentPage=1,await P()}catch(r){console.error("Error filtering pokemons by type:",r)}finally{n.loader.style.display="none"}}function k(){console.log("Resetting type filter, showing all pokemons."),e.currentFilterType="",e.filteredPokemons=[...e.allPokemons],v(),e.currentPage=1,P()}function v(){const t=e.filteredPokemons.length>0?e.filteredPokemons:e.allPokemons;switch(e.sortOption){case"id-asc":t.sort((r,o)=>s(r.url)-s(o.url));break;case"id-desc":t.sort((r,o)=>s(o.url)-s(r.url));break;case"name-asc":t.sort((r,o)=>r.name.localeCompare(o.name));break;case"name-desc":t.sort((r,o)=>o.name.localeCompare(r.name));break}e.filteredPokemons.length>0?e.filteredPokemons=t:e.allPokemons=t}function H(){const t=n.searchInput.value.toLowerCase().trim();e.searchTerm=t,n.searchClear.style.display=t?"block":"none",t?R(t):b()}function R(t){const r=e.currentFilterType?e.filteredPokemons.length>0?e.filteredPokemons:e.allPokemons.filter(o=>z(o,e.currentFilterType)):e.allPokemons;e.filteredPokemons=r.filter(o=>{const a=s(o.url).toString(),i=o.name.toLowerCase();return a.includes(t)||i.includes(t)}),j()}function j(){e.totalPages=Math.ceil(e.filteredPokemons.length/u),e.currentPage=1,e.filteredPokemons.length===0?O():N()}async function b(){e.searchTerm="",n.searchInput.value="",n.searchClear.style.display="none",e.currentFilterType?(e.filteredPokemons=e.allPokemons.filter(t=>{const r=s(t.url);return d.has(r)?d.get(r).includes(e.currentFilterType):!0}),await G()):e.filteredPokemons=[...e.allPokemons],v(),e.currentPage=1,P()}const d=new Map;async function z(t,r){const o=s(t.url);if(!d.has(o)){const a=await f(o);d.set(o,(a==null?void 0:a.types.map(i=>i.type.name))||[])}return d.get(o).includes(r)}function U(){n.searchInput.value="",n.searchClear.style.display="none",b(),n.listWrapper.style.opacity="0",setTimeout(()=>{n.listWrapper.style.opacity="1"},150)}async function G(){const t=e.filteredPokemons.filter(r=>{const o=s(r.url);return!d.has(o)});await Promise.all(t.map(async r=>{const o=s(r.url),a=await f(o);d.set(o,a.types.map(i=>i.type.name))})),e.filteredPokemons=e.filteredPokemons.filter(r=>{var a;const o=s(r.url);return(a=d.get(o))==null?void 0:a.includes(e.currentFilterType)})}function h(){const t=n.sortSelect.value;e.sortOption=t;const r=e.filteredPokemons.length>0?e.filteredPokemons:e.allPokemons;switch(t){case"id-asc":r.sort((o,a)=>s(o.url)-s(a.url));break;case"id-desc":r.sort((o,a)=>s(a.url)-s(o.url));break;case"name-asc":r.sort((o,a)=>o.name.localeCompare(a.name));break;case"name-desc":r.sort((o,a)=>a.name.localeCompare(o.name));break}e.filteredPokemons.length>0?e.filteredPokemons=r:e.allPokemons=r,e.currentPage=1,P()}function J(){n.firstButton.addEventListener("click",()=>m(1)),n.prevButton.addEventListener("click",()=>m(e.currentPage-1)),n.nextButton.addEventListener("click",()=>m(e.currentPage+1)),n.lastButton.addEventListener("click",()=>m(e.totalPages)),n.goButton.addEventListener("click",E),n.pageInput.addEventListener("keypress",t=>{t.key==="Enter"&&E()}),n.filterSelect.addEventListener("change",W),n.searchInput.addEventListener("input",H),n.searchClear.addEventListener("click",U),n.sortSelect.addEventListener("change",()=>{e.currentSort=n.sortSelect.value,h()})}function E(){const t=parseInt(n.pageInput.value,10);!isNaN(t)&&t>=1&&t<=e.totalPages?m(t):n.pageInput.value=e.currentPage}n.loader.innerHTML=`
  <div class="loader-container">
    <div class="o-pokeball u-tada"></div>
    <p class="loader-text">Pokémons are coming...</p>
  </div>
`;document.body.appendChild(n.loader);async function q(){try{const t=localStorage.getItem("pokedexState");if(n.filterSelect.value="",e.currentFilterType="",t){const r=JSON.parse(t);n.searchInput.value=r.searchTerm||"",n.sortSelect.value=r.currentSort||"id-asc",r.currentFilterType&&(n.filterSelect.value=r.currentFilterType,e.currentFilterType=r.currentFilterType),await F(),h(),r.searchTerm||(r.currentFilterType?await C(r.currentFilterType):k())}else n.loader.style.display="flex",await F(),h(),k();J()}catch(t){console.error("Error initializing app:",t)}finally{n.loader.style.display="none"}}q();
