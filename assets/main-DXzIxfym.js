import{m as r,t as M}from"./typeIcons-D_VbJyR3.js";const e={allPokemons:[],filteredPokemons:[],currentPage:1,itemsPerPage:12,sortOption:"id-asc",currentFilterType:"",searchTerm:""};function B(t){const n={currentPage:e.currentPage,currentSort:e.sortOption,currentFilterType:e.currentFilterType||"",searchTerm:r.searchInput.value.trim()};localStorage.setItem("pokedexState",JSON.stringify(n)),localStorage.setItem("currentPokemonID",t),window.location.href=`details.html?id=${t}`}const p=12;async function C(){try{const n=await(await fetch("https://pokeapi.co/api/v2/pokemon?limit=10000")).json();e.allPokemons=n.results.filter(a=>c(a.url)<1e4),console.log("Pokemons loaded:",e.allPokemons),e.totalPages=Math.ceil(e.allPokemons.length/p)}catch(t){throw console.error("Error fetching all pokemons:",t),t}}async function g(t){try{return await(await fetch(`https://pokeapi.co/api/v2/pokemon/${t}`)).json()}catch(n){return console.error(`Failed to fetch Pokemon data for ID ${t}:`,n),null}}function c(t){const n=t.split("/").filter(Boolean);return parseInt(n[n.length-1],10)}function _(t){return t.charAt(0).toUpperCase()+t.slice(1)}async function m(){try{r.listWrapper.innerHTML="",r.loader.style.display="flex";const t=e.filteredPokemons.length>0?e.filteredPokemons:e.allPokemons;e.totalPages=Math.ceil(t.length/p),e.currentPage=Math.min(e.currentPage,e.totalPages||1);const n=t.slice((e.currentPage-1)*p,e.currentPage*p),a=await Promise.all(n.map(o=>g(c(o.url))));T(n,a)}finally{r.loader.style.display="none",L()}}function T(t,n){r.listWrapper.innerHTML="",r.listWrapper.style.opacity="0";const a=document.createDocumentFragment(),o=[];t.forEach((i,u)=>{if(n[u]){const P=c(i.url),{card:l,imageLoadPromise:f}=$(i,P,n[u]);o.push(f),a.appendChild(l)}}),r.listWrapper.appendChild(a),Promise.all(o).then(()=>{r.listWrapper.style.opacity="1"})}function $(t,n,a){if(!a)return document.createElement("div");const o=document.createElement("div");o.className="card",o.dataset.id=n;const u=a.types.map(s=>s.type.name).map(s=>`
    <div class="card__type ${s}">
      <img src="${M[s]}" title="${s}" alt="${s}" />
      <div>${s}</div>
    </div>
  `).join("");o.innerHTML=`
    <div class="card__id">#${String(n).padStart(4,"0")}</div>
    <div class="card__img"></div>
    <div class="card__name">${_(t.name)}</div>
    <div class="card__types">${u}</div>
  `;const P=(s,b)=>{var y,h,k,v;return s!=null&&s.sprites?((h=(y=s.sprites.other)==null?void 0:y.home)==null?void 0:h.front_default)||((v=(k=s.sprites.other)==null?void 0:k["official-artwork"])==null?void 0:v.front_default)||s.sprites.front_default:`https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/home/${b}.png`},l=document.createElement("img");l.src=P(a,n),l.alt=t.name,l.loading="lazy",l.onerror=()=>{l.src=`https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/${n}.png`,l.onerror=()=>{l.src=`https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/${n}.png`}};const f=new Promise(s=>{l.onload=()=>{l.classList.add("loaded"),s()},l.onerror=()=>s()});return o.querySelector(".card__img").appendChild(l),o.addEventListener("click",()=>{B(n)}),{card:o,imageLoadPromise:f}}function L(){r.pageInfo.textContent=`Page ${e.currentPage} of ${e.totalPages}`,r.pageInput.value=e.currentPage,document.querySelectorAll(".firstButton, .prevButton").forEach(t=>{t.disabled=e.currentPage===1,t.classList.toggle("disabled",e.currentPage===1)}),document.querySelectorAll(".nextButton, .lastButton").forEach(t=>{t.disabled=e.currentPage===e.totalPages||e.totalPages===0,t.classList.toggle("disabled",e.currentPage===e.totalPages||e.totalPages===0)})}async function O(){r.listWrapper.innerHTML="",r.loader.style.display="flex";try{const t=(e.currentPage-1)*p,n=t+p,a=e.filteredPokemons.slice(t,n),o=await Promise.all(a.map(i=>g(c(i.url))));T(a,o),L()}catch(t){console.error("Error displaying filtered pokemons:",t)}finally{r.loader.style.display="none"}}function W(){r.listWrapper.innerHTML=`
    <div class="no-results">No Pokémon found</div>
  `}async function d(t){t=Math.max(1,Math.min(t,e.totalPages)),t!==e.currentPage&&(e.currentPage=t,await m())}async function x(){const t=r.filterSelect.value;if(e.currentFilterType=t,!e.allPokemons.length){console.warn("Pokemons are not yet loaded.");return}t===""?A():await S(t)}async function S(t){try{if(r.listWrapper.innerHTML="",r.loader.style.display="flex",!t)e.filteredPokemons=[],e.currentFilterType="";else{const n=await Promise.all(e.allPokemons.map(a=>g(c(a.url))));e.filteredPokemons=e.allPokemons.filter((a,o)=>{const i=n[o];return i&&i.types.some(u=>u.type.name===t)}),e.currentFilterType=t}e.currentPage=1,await m()}catch(n){console.error("Error filtering pokemons by type:",n)}finally{r.loader.style.display="none"}}function A(){console.log("Resetting type filter, showing all pokemons."),e.currentFilterType="",e.filteredPokemons=[...e.allPokemons],e.currentPage=1,m()}function E(){const t=r.searchInput.value.toLowerCase().trim();e.searchTerm=t,r.searchClear&&(r.searchClear.style.display=t?"block":"none"),t?N(t):w()}function N(t){const a=(e.currentFilterType?e.typeFiltered:e.allPokemons).filter(o=>{const i=c(o.url).toString(),u=o.name.toLowerCase();return i.includes(t)||u.includes(t)});e.currentDisplay=a,e.filteredPokemons=a,H()}function H(){e.totalPages=Math.ceil(e.currentDisplay.length/p),e.currentPage=1,e.currentDisplay.length===0?W():O()}function R(){r.searchInput&&(r.searchInput.value=""),r.searchClear&&(r.searchClear.style.display="none"),w(),r.listWrapper&&(r.listWrapper.style.opacity="0",setTimeout(()=>{r.listWrapper.style.opacity="1"},150))}function w(){e.searchTerm="",e.currentDisplay=e.currentFilterType?e.typeFiltered:e.allPokemons,e.currentPage=1,m()}function F(){const t=e.filteredPokemons.length>0?e.filteredPokemons:e.allPokemons;switch(e.sortOption){case"id-asc":t.sort((n,a)=>c(n.url)-c(a.url));break;case"id-desc":t.sort((n,a)=>c(a.url)-c(n.url));break;case"name-asc":t.sort((n,a)=>n.name.localeCompare(a.name));break;case"name-desc":t.sort((n,a)=>a.name.localeCompare(n.name));break}m()}function z(){r.firstButton.addEventListener("click",()=>d(1)),r.prevButton.addEventListener("click",()=>d(e.currentPage-1)),r.nextButton.addEventListener("click",()=>d(e.currentPage+1)),r.lastButton.addEventListener("click",()=>d(e.totalPages)),r.firstButtonMobile.addEventListener("click",()=>d(1)),r.prevButtonMobile.addEventListener("click",()=>d(e.currentPage-1)),r.nextButtonMobile.addEventListener("click",()=>d(e.currentPage+1)),r.lastButtonMobile.addEventListener("click",()=>d(e.totalPages)),r.pageInput.addEventListener("keypress",t=>{t.key==="Enter"&&j()}),r.filterSelect.addEventListener("change",x),r.searchInput.addEventListener("input",E),r.searchClear.addEventListener("click",R),r.sortSelect.addEventListener("change",()=>{e.sortOption=r.sortSelect.value,F();const t={currentPage:e.currentPage,currentSort:e.sortOption,currentFilterType:e.currentFilterType,searchTerm:e.searchTerm};localStorage.setItem("pokedexState",JSON.stringify(t))})}function j(){const t=parseInt(r.pageInput.value,10);!isNaN(t)&&t>=1&&t<=e.totalPages?d(t):r.pageInput.value=e.currentPage}async function I(){try{if(r.loader.style.display="flex",await C(),!e.allPokemons||!e.allPokemons.length)throw new Error("Failed to load Pokémon data");e.filteredPokemons=[...e.allPokemons];const t=localStorage.getItem("pokedexState");if(t){const n=JSON.parse(t);e.sortOption=n.currentSort||"id-asc",e.currentFilterType=n.currentFilterType||"",e.searchTerm=n.searchTerm||"",r.sortSelect.value=e.sortOption,r.filterSelect.value=e.currentFilterType,r.searchInput.value=e.searchTerm,e.searchTerm?await E():e.currentFilterType&&await S(e.currentFilterType)}F(),await m(),z()}catch(t){console.error("Error initializing app:",t),r.listWrapper.innerHTML=`
      <div class="error-message">
        Failed to initialize. <button id="retry-btn">Retry</button>
      </div>
    `,document.getElementById("retry-btn").addEventListener("click",I)}finally{r.loader.style.display="none"}}I();
